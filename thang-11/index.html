<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo cáo Tài chính Chu kỳ 11/2025 (20/10 - 18/11)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f0f2f5;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <!-- Header -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 text-white p-2 rounded-lg">
                        <i class="fa-solid fa-chart-pie text-xl"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-xl text-gray-900 leading-tight">Phân Tích Tài Chính</h1>
                        <p class="text-xs text-gray-500">Chu kỳ: 20/10/2025 - 18/11/2025 (Dữ liệu thực tế)</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="window.print()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors">
                        <i class="fa-solid fa-print mr-2"></i>In Báo cáo
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        
        <!-- 1. KPI Overview Section -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 animate-fade-in" style="animation-delay: 0.1s;">
            <!-- Thu nhập -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Tổng Thực Thu</p>
                        <h3 class="text-2xl font-bold text-gray-900 mt-1">22.350.000</h3>
                        <span class="text-xs text-gray-400">VNĐ</span>
                    </div>
                    <span class="p-2 bg-green-50 text-green-600 rounded-lg"><i class="fa-solid fa-wallet"></i></span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-1.5">
                    <div class="bg-green-500 h-1.5 rounded-full" style="width: 100%"></div>
                </div>
                <p class="text-xs text-gray-500 mt-2">Lương 2vc + Bà nội cho + Rút quỹ</p>
            </div>

            <!-- Chi tiêu -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Tổng Thực Chi</p>
                        <h3 class="text-2xl font-bold text-gray-900 mt-1">20.108.710</h3>
                        <span class="text-xs text-gray-400">VNĐ</span>
                    </div>
                    <span class="p-2 bg-red-50 text-red-600 rounded-lg"><i class="fa-solid fa-money-bill-transfer"></i></span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-1.5">
                    <div class="bg-red-500 h-1.5 rounded-full" style="width: 90%"></div>
                </div>
                <p class="text-xs text-red-600 mt-2 font-medium">90% Thu nhập (Đã gồm tích lũy)</p>
            </div>

            <!-- Tích lũy (Tách riêng) -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Đã Tích Lũy</p>
                        <h3 class="text-2xl font-bold text-indigo-600 mt-1">4.000.000</h3>
                        <span class="text-xs text-gray-400">VNĐ</span>
                    </div>
                    <span class="p-2 bg-indigo-50 text-indigo-600 rounded-lg"><i class="fa-solid fa-vault"></i></span>
                </div>
                <p class="text-xs text-indigo-600 font-medium mt-2">Chiếm 19.9% Tổng chi</p>
                <p class="text-xs text-gray-400">Chuyển vào quỹ dự phòng/CK</p>
            </div>

            <!-- Thặng dư -->
            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm card-hover">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Số Dư Thực</p>
                        <h3 class="text-2xl font-bold text-blue-600 mt-1">+2.241.290</h3>
                        <span class="text-xs text-gray-400">VNĐ</span>
                    </div>
                    <span class="p-2 bg-blue-50 text-blue-600 rounded-lg"><i class="fa-solid fa-piggy-bank"></i></span>
                </div>
                <p class="text-xs text-blue-600 font-medium mt-2">Dư cuối kỳ</p>
            </div>
        </div>

        <!-- 2. Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in" style="animation-delay: 0.2s;">
            
            <!-- Left: Structure (Pie Chart) -->
            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Cơ Cấu Chi Tiêu Thực Tế</h3>
                <div class="relative h-64 w-full">
                    <canvas id="expensePieChart"></canvas>
                </div>
                <div class="mt-4 text-center">
                    <span class="inline-block px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">
                        <i class="fa-solid fa-baby-carriage mr-1"></i>Con cái chiếm tỷ trọng lớn nhất (39%)
                    </span>
                </div>
            </div>

            <!-- Right: Weekly Trend (Bar) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                 <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">Diễn Biến Theo Tuần</h3>
                        <p class="text-sm text-gray-500">Cao điểm vào Tuần 2 (Tích lũy) và Tuần 3 (Học phí + Tiêm)</p>
                    </div>
                </div>
                <div class="h-64 w-full">
                    <canvas id="weeklyTrendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 3. Detailed Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in" style="animation-delay: 0.3s;">
            
            <!-- Insight Box -->
            <div class="lg:col-span-1 bg-white p-6 rounded-2xl border border-gray-100 shadow-sm flex flex-col justify-between">
                <div>
                    <h3 class="text-lg font-bold text-gray-900 mb-4"><i class="fa-solid fa-magnifying-glass-chart mr-2 text-blue-500"></i>Phân Tích Lại</h3>
                    <div class="space-y-4">
                        <div class="p-3 bg-red-50 rounded-lg border border-red-100">
                            <h4 class="text-sm font-bold text-red-800 mb-1">Con cái: ~7.9 Triệu (39%)</h4>
                            <p class="text-xs text-red-600">Đúng như bạn nghi ngờ, đây là khoản lớn nhất. Bao gồm các khoản "nặng đô": Học phí (2.35M), Tiêm phòng (1.79M), Sức khỏe/Thuốc ( >1M).</p>
                        </div>
                        <div class="p-3 bg-indigo-50 rounded-lg border border-indigo-100">
                            <h4 class="text-sm font-bold text-indigo-800 mb-1">Tích lũy: 4 Triệu (20%)</h4>
                            <p class="text-xs text-indigo-600">Điểm sáng lớn nhất. Dù chi tiêu cao nhưng bạn vẫn kỷ luật trích 4M vào các quỹ dự phòng/tiết kiệm. Đây là thói quen tuyệt vời.</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <h4 class="text-sm font-bold text-gray-800 mb-1">Hưởng thụ: Chỉ 130k</h4>
                            <p class="text-xs text-gray-600">Rất thấp (chỉ 0.6%). Tháng này bạn đã "thắt lưng buộc bụng" khoản ăn chơi để dồn tiền cho con và tích lũy.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Spending Table -->
            <div class="lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="text-lg font-bold text-gray-900">Top 5 Khoản Chi Lớn Nhất</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-white text-xs text-gray-500 uppercase">
                            <tr>
                                <th class="px-6 py-3">Ngày</th>
                                <th class="px-6 py-3">Hạng mục</th>
                                <th class="px-6 py-3">Diễn giải</th>
                                <th class="px-6 py-3 text-right">Số tiền</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 font-medium">07/11</td>
                                <td class="px-6 py-3"><span class="text-green-600 font-bold">Con cái</span></td>
                                <td class="px-6 py-3">Học phí + Ăn tại trường</td>
                                <td class="px-6 py-3 text-right font-bold">2.350.000</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 font-medium">06/11</td>
                                <td class="px-6 py-3"><span class="text-indigo-600 font-bold">Tích lũy</span></td>
                                <td class="px-6 py-3">Chuyển vào Quỹ dự phòng</td>
                                <td class="px-6 py-3 text-right font-bold">2.000.000</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 font-medium">02/11</td>
                                <td class="px-6 py-3"><span class="text-indigo-600 font-bold">Tích lũy</span></td>
                                <td class="px-6 py-3">Quỹ dự phòng (Chuyển cho ck)</td>
                                <td class="px-6 py-3 text-right font-bold">2.000.000</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 font-medium">10/11</td>
                                <td class="px-6 py-3"><span class="text-green-600 font-bold">Con cái</span></td>
                                <td class="px-6 py-3">Tiêm mũi mô cầu não</td>
                                <td class="px-6 py-3 text-right font-bold">1.788.000</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 font-medium">26/10</td>
                                <td class="px-6 py-3"><span class="text-blue-600 font-bold">Sinh hoạt</span></td>
                                <td class="px-6 py-3">Tiền điện tháng</td>
                                <td class="px-6 py-3 text-right font-bold">1.160.460</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <footer class="text-center text-gray-400 text-sm pt-8 pb-4">
            <p>© 2025 Financial Report System - Data Source: User Provided (Nov 18 Ver)</p>
        </footer>

    </main>

    <script>
        // --- CẤU HÌNH BIỂU ĐỒ (Dữ liệu chính xác) ---
        Chart.defaults.font.family = "'Be Vietnam Pro', sans-serif";
        Chart.defaults.color = '#6b7280';

        // 1. Pie Chart
        const ctxPie = document.getElementById('expensePieChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'doughnut',
            data: {
                labels: ['Con cái (39%)', 'Dịch vụ sinh hoạt (36%)', 'Tích lũy/Quỹ (20%)', 'Xã hội (4%)', 'Hưởng thụ (<1%)'],
                datasets: [{
                    data: [7868000, 7216710, 4000000, 894000, 130000], 
                    backgroundColor: ['#10b981', '#3b82f6', '#6366f1', '#f59e0b', '#ec4899'],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { usePointStyle: true, padding: 15 } }
                },
                cutout: '65%'
            }
        });

        // 2. Weekly Bar Chart (Updated Logic)
        const ctxWeekly = document.getElementById('weeklyTrendChart').getContext('2d');
        new Chart(ctxWeekly, {
            type: 'bar',
            data: {
                labels: ['Tuần 1 (20-26/10)', 'Tuần 2 (27/10-2/11)', 'Tuần 3 (3-10/11)', 'Tuần 4 (11-18/11)'],
                datasets: [
                    {
                        label: 'Thu Nhập',
                        data: [20050000, 2000000, 0, 300000], // Lương về tuần 1
                        backgroundColor: '#dcfce7',
                        borderColor: '#22c55e',
                        borderWidth: 1,
                        borderRadius: 4,
                        categoryPercentage: 0.6
                    },
                    {
                        label: 'Chi Tiêu',
                        data: [2100000, 6000000, 9000000, 2700000], // Week 3 cao nhất do học phí + tiêm
                        backgroundColor: (ctx) => {
                            const val = ctx.raw;
                            return val > 8000000 ? '#ef4444' : '#fee2e2'; // Highlight tuần chi cao
                        },
                        borderColor: '#ef4444',
                        borderWidth: 1,
                        borderRadius: 4,
                        categoryPercentage: 0.6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { borderDash: [2, 2] },
                        ticks: { callback: (v) => v/1000000 + 'M' }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    </script>
</body>
</html>
